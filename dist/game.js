var f=Object.defineProperty;var p=(n,t,i)=>t in n?f(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var e=(n,t,i)=>p(n,typeof t!="symbol"?t+"":t,i);import"./modulepreload-polyfill.js";class d{constructor(t,i){e(this,"x");e(this,"y");e(this,"width",24);e(this,"height",40);e(this,"vx",0);e(this,"vy",0);e(this,"isGrounded",!1);e(this,"hp",5);e(this,"color","#FFD700");e(this,"state","idle");e(this,"facingLeft",!0);e(this,"idleTime",0);e(this,"sprites",{});e(this,"frameTime",0);e(this,"walkFrameIndex",0);e(this,"WALK_SEQUENCE",[1,2,3,2]);e(this,"blinkTimer",0);e(this,"isBlinking",!1);e(this,"GRAVITY_ACCEL",1200);e(this,"JUMP_VELOCITY",-600);e(this,"MOVE_SPEED",300);this.x=t,this.y=i,this.loadSprites()}loadSprites(){["idle","walk-1","walk-2","walk-3","jump","hurt","gameover","sleep"].forEach(i=>{var h;const s=new Image;s.src=(h=chrome.runtime)!=null&&h.getURL?chrome.runtime.getURL(`sprites/${i}.png`):`/sprites/${i}.png`,this.sprites[i]=s})}update(t){this.state!=="dead"&&(this.vy+=this.GRAVITY_ACCEL*t,this.x+=this.vx*t,this.y+=this.vy*t,this.updateState(t),this.state==="idle"?(this.blinkTimer-=t,this.blinkTimer<=0&&(this.isBlinking=!this.isBlinking,this.blinkTimer=this.isBlinking?.15:Math.random()*3+2)):this.isBlinking=!1)}moveRelative(t){this.state!=="dead"&&(this.vx=t*this.MOVE_SPEED,t!==0&&(this.facingLeft=t<0,this.idleTime=0))}jump(){this.state!=="dead"&&this.isGrounded&&(this.vy=this.JUMP_VELOCITY,this.isGrounded=!1,this.idleTime=0)}updateState(t){if(this.hp<=0){this.state="dead";return}if(this.state!=="hurt"){if(!this.isGrounded){this.state="jump";return}Math.abs(this.vx)>10?(this.state="walk",this.frameTime+=t,this.frameTime>.15&&(this.walkFrameIndex=(this.walkFrameIndex+1)%this.WALK_SEQUENCE.length,this.frameTime=0)):(this.state!=="idle"&&this.state!=="sleep"&&(this.state="idle",this.idleTime=0),this.state==="idle"&&(this.idleTime+=t,this.idleTime>2&&(this.state="sleep")))}}draw(t){t.save();const i=this.x+this.width/2,s=this.y+this.height/2;t.translate(i,s),this.facingLeft||t.scale(-1,1);let h=this.sprites.idle;if(this.state==="jump")h=this.sprites.jump;else if(this.state==="hurt")h=this.sprites.hurt;else if(this.state==="dead")h=this.sprites.gameover;else if(this.state==="sleep")h=this.sprites.sleep;else if(this.state==="walk"){const a=this.WALK_SEQUENCE[this.walkFrameIndex];h=this.sprites[`walk-${a}`]}else this.state==="idle"&&this.isBlinking&&(h=this.sprites.sleep);h&&h.complete?t.drawImage(h,-20,-20,40,40):(t.fillStyle=this.color,t.fillRect(-20,-20,40,40)),t.restore()}setHurt(t=1e3){this.state!=="dead"&&(this.state="hurt",setTimeout(()=>{this.state==="hurt"&&this.hp>0&&(this.state="idle",this.idleTime=0)},t))}}class o{constructor(t,i,s,h,a,r){e(this,"x");e(this,"y");e(this,"width");e(this,"height");e(this,"type");e(this,"floorIndex");e(this,"SPEED_UP",100);this.x=t,this.y=i,this.width=s,this.height=h,this.type=a,this.floorIndex=r}update(t){this.y-=this.SPEED_UP*t}draw(t,i){if(this.type==="normal"?t.fillStyle="#8B4513":this.type==="spike"?t.fillStyle="#800000":this.type.startsWith("conveyor")&&(t.fillStyle="#708090"),t.fillRect(this.x,this.y,this.width,this.height),this.type==="spike"){t.fillStyle="#C0C0C0";const s=10,h=Math.floor(this.width/s);t.beginPath();for(let a=0;a<h;a++){const r=this.x+a*s,l=this.y;t.moveTo(r,l),t.lineTo(r+s/2,l-10),t.lineTo(r+s,l)}t.fill()}else if(this.type.startsWith("conveyor")){t.fillStyle="#333";const s=10,h=.1,a=this.type==="conveyor_left"?-1:1,r=i*h*a%(2*s);t.save(),t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.clip();for(let l=this.x+r-20;l<this.x+this.width+20;l+=s*2)t.fillRect(l,this.y,s,this.height);t.restore(),t.fillStyle="#000";for(let l=this.x+5;l<this.x+this.width;l+=20)t.beginPath(),t.arc(l,this.y+this.height,4,0,Math.PI*2),t.fill()}}}class c{constructor(t,i){e(this,"platforms",[]);e(this,"canvasWidth");e(this,"canvasHeight");e(this,"currentFloorIndex",0);e(this,"passedFloors",0);e(this,"SPACING_Y",85);this.canvasWidth=t,this.canvasHeight=i,this.initPlatforms()}initPlatforms(){this.platforms=[],this.currentFloorIndex=0,this.passedFloors=0;const t=this.canvasHeight-100,i=100,s=(this.canvasWidth-i)/2;this.platforms.push(new o(s,t,i,20,"normal",this.currentFloorIndex)),this.currentFloorIndex++;for(let h=1;h<=6;h++)this.spawnPlatformSafe(t+h*this.SPACING_Y,h<3)}spawnPlatform(t){this.spawnPlatformSafe(t,!1)}spawnPlatformSafe(t,i){if(!i&&Math.random()<.2)return;const s=100,h=20,a=Math.random()*(this.canvasWidth-s);let r="normal";if(!i){const l=Math.random();l>.8?r="spike":l>.6?r="conveyor_left":l>.4&&(r="conveyor_right")}this.platforms.push(new o(a,t,s,h,r,this.currentFloorIndex)),this.currentFloorIndex++}update(t){for(const h of this.platforms)h.update(t);const i=this.platforms.length;this.platforms=this.platforms.filter(h=>h.y>-50);const s=i-this.platforms.length;this.passedFloors+=s,this.spawnCheck()}spawnCheck(){let t=-1/0;for(const i of this.platforms)i.y>t&&(t=i.y);t<this.canvasHeight+50&&this.spawnPlatform(t+this.SPACING_Y)}draw(t,i){for(const s of this.platforms)s.draw(t,i)}getMaxFloorIndex(){return this.passedFloors}}class y{constructor(t){e(this,"canvas");e(this,"ctx");e(this,"lastTime",0);e(this,"isPlaying",!1);e(this,"player");e(this,"platformManager");e(this,"scoreDepth",0);e(this,"lastDamageTime",0);e(this,"isGameOver",!1);e(this,"showGameOverUI",!1);e(this,"keys",{});this.canvas=t;const i=t.getContext("2d");if(!i)throw new Error("Could not get 2D context");this.ctx=i,this.resize(),this.platformManager=new c(this.canvas.width,this.canvas.height);const s=this.platformManager.platforms[0],h=s.x+(s.width-30)/2,a=s.y-30;this.player=new d(h,a)}resize(){this.canvas.width=400,this.canvas.height=600}start(){this.isPlaying||(this.isPlaying=!0,this.lastTime=performance.now(),this.setupInput(),requestAnimationFrame(t=>this.loop(t)))}setupInput(){window.addEventListener("keydown",t=>{this.keys[t.key]=!0,this.showGameOverUI&&location.reload()}),window.addEventListener("keyup",t=>{this.keys[t.key]=!1})}update(t){t>.1&&(t=.1),this.platformManager.update(t),this.scoreDepth+=100*t,this.updateHUD(),this.keys.ArrowLeft?this.player.moveRelative(-1):this.keys.ArrowRight?this.player.moveRelative(1):this.player.moveRelative(0),this.keys.ArrowUp&&this.player.jump(),this.player.update(t),this.player.isGrounded=!1;let i=!1;for(const s of this.platformManager.platforms){const h=this.player.y+this.player.height,a=s.y;if(this.player.x+this.player.width>s.x&&this.player.x<s.x+s.width){this.player.vy>=0&&h>=a&&h<=a+20&&(this.player.isGrounded=!0,this.player.vy=0,this.player.y=a-this.player.height,s.type==="conveyor_left"?this.player.x-=200*t:s.type==="conveyor_right"?this.player.x+=200*t:s.type==="spike"&&(i=!0));const r=s.y+s.height;this.player.vy<0&&this.player.y<=r&&this.player.y>=r-20&&(this.player.vy=0,this.player.y=r)}}i&&(this.takeDamage(1),this.player.vy=-500),this.player.x<0&&(this.player.x=0),this.player.x+this.player.width>this.canvas.width&&(this.player.x=this.canvas.width-this.player.width),this.player.y<0&&(this.takeDamage(1),this.player.vy=200),this.player.y>this.canvas.height&&this.takeDamage(5)}takeDamage(t){const i=performance.now();i-this.lastDamageTime<250||(this.player.hp-=t,this.lastDamageTime=i,this.player.hp<=0?this.gameOver():this.player.setHurt(1e3))}gameOver(){this.isGameOver||(this.isGameOver=!0,this.player.hp=0,this.player.state="dead",setTimeout(()=>{this.showGameOverUI=!0},500))}updateHUD(){const t=document.getElementById("hp"),i=document.getElementById("score");if(t){const s="â™¥".repeat(Math.max(0,this.player.hp));t.innerText=s}if(i){const s=this.platformManager.getMaxFloorIndex();i.innerText=`FLOOR: ${s}`}}draw(){this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.platformManager.draw(this.ctx,this.lastTime),this.player.draw(this.ctx),this.ctx.fillStyle="#C0C0C0";const t=20,i=15,s=Math.ceil(this.canvas.width/t);this.ctx.beginPath();for(let h=0;h<s;h++){const a=h*t,r=0;this.ctx.moveTo(a,r),this.ctx.lineTo(a+t/2,r+i),this.ctx.lineTo(a+t,r)}if(this.ctx.fill(),this.showGameOverUI){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.textAlign="center",this.ctx.fillStyle="#FFD700",this.ctx.font="bold 48px Arial",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-20),this.ctx.fillStyle="#CCC",this.ctx.font="24px Arial";const h=this.platformManager.getMaxFloorIndex();this.ctx.fillText(`FLOOR: ${h}`,this.canvas.width/2,this.canvas.height/2+30),this.ctx.font="16px Arial",this.ctx.fillStyle="#FFF",this.ctx.fillText("Press any key to restart",this.canvas.width/2,this.canvas.height/2+70),this.ctx.restore()}}loop(t){if(!this.isPlaying)return;const i=(t-this.lastTime)/1e3;this.lastTime=t,this.isGameOver||this.update(i),this.draw(),requestAnimationFrame(s=>this.loop(s))}}window.addEventListener("load",()=>{const n=document.getElementById("game-canvas");n&&new y(n).start()});
